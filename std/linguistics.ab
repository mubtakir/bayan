// std/linguistics.ab - ÙˆØ§Ø¬Ù‡Ø© Ø¹Ù„Ù… Ø¯Ù„Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±ÙˆÙ
//
// ØªØ·Ø¨ÙŠÙ‚ Ø±Ø¤ÙŠØ© Ø§Ù„Ø®Ø¨ÙŠØ± Ø­ÙˆÙ„ "Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø§Ø´ØªÙ‚Ø§Ù‚ÙŠØ©" Ùˆ "Ø¹Ù„Ù… Ø£ØµÙ„ Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨ÙŠ"
// Computational Etymology/Semiotics - ÙÙ‡Ù… "Ù„Ù…Ø§Ø°Ø§" Ø§Ù„ÙƒÙ„Ù…Ø§Øª ØªØ¹Ù†ÙŠ Ù…Ø§ ØªØ¹Ù†ÙŠÙ‡

// === Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ===

/// Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯Ù„Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±Ù
struct LetterInfo {
    sound_semantics: list<string>,    // Ø§Ù„Ù…Ø¹Ø§Ù†ÙŠ Ø§Ù„ØµÙˆØªÙŠØ©
    shape_semantics: list<string>,    // Ø§Ù„Ù…Ø¹Ø§Ù†ÙŠ Ø§Ù„Ø´ÙƒÙ„ÙŠØ©
    energy_type: string,              // Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ù‚Ø©
    natural_element: string,          // Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
    influence_strength: f64,          // Ù‚ÙˆØ© Ø§Ù„ØªØ£Ø«ÙŠØ±
    additional_properties: list<string>, // Ø®ØµØ§Ø¦Øµ Ø¥Ø¶Ø§ÙÙŠØ©
}

/// Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠ Ù„Ù„ÙƒÙ„Ù…Ø©
struct WordSemanticSignature {
    word: string,                     // Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
    language: string,                 // Ø§Ù„Ù„ØºØ©
    semantic_signature: list<string>, // Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠ
    signature_strength: f64,          // Ù‚ÙˆØ© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹
    energy_analysis: string,          // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ø§Ù‚Ø©
    dominant_element: string,         // Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ù‡ÙŠÙ…Ù†
}

// === Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ===

/// ØªØ­Ù„ÙŠÙ„ ÙƒÙ„Ù…Ø© ÙˆØ¥Ù†Ø´Ø§Ø¡ ØªÙˆÙ‚ÙŠØ¹Ù‡Ø§ Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠ
extern fn analyze_word_semantics(word: string, language: string = "ar") -> bool {
    return albayan_rt_analyze_word_semantics(word.c_str(), language.c_str()) == 1;
}

/// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯Ù„Ø§Ù„Ø§Øª Ø­Ø±Ù Ù…Ø¹ÙŠÙ†
extern fn get_character_semantics(character: char, language: string = "ar") -> string {
    let info_ptr = albayan_rt_get_character_semantics(character as i8, language.c_str());
    if info_ptr != null {
        let info = string::from_c_str(info_ptr);
        albayan_rt_free_linguistic_string(info_ptr);
        return info;
    } else {
        return "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©";
    }
}

/// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ù„ØºÙˆÙŠ
extern fn get_linguistic_stats() -> i32 {
    return albayan_rt_get_linguistic_stats();
}

// === Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ===

/// ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„ÙƒÙ„Ù…Ø© Ø¹Ø±Ø¨ÙŠØ©
fn analyze_arabic_word_comprehensive(word: string) -> bool {
    print("ğŸ” ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„ÙƒÙ„Ù…Ø© '" + word + "':");
    
    let success = analyze_word_semantics(word, "ar");
    
    if success {
        print("âœ… ØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠ Ø¨Ù†Ø¬Ø§Ø­!");
        
        // ØªØ­Ù„ÙŠÙ„ ÙƒÙ„ Ø­Ø±Ù ÙÙŠ Ø§Ù„ÙƒÙ„Ù…Ø©
        print("ğŸ“ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø±ÙˆÙ:");
        let chars = word.chars();
        let i = 0;
        while i < chars.length() {
            let ch = chars[i];
            let semantics = get_character_semantics(ch, "ar");
            print("   " + ch.to_string() + ": " + semantics);
            i = i + 1;
        }
        
        return true;
    } else {
        print("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠ");
        return false;
    }
}

/// ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„ÙƒÙ„Ù…Ø© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
fn analyze_english_word_comprehensive(word: string) -> bool {
    print("ğŸ” Comprehensive analysis of word '" + word + "':");
    
    let success = analyze_word_semantics(word, "en");
    
    if success {
        print("âœ… Semantic analysis successful!");
        
        // ØªØ­Ù„ÙŠÙ„ ÙƒÙ„ Ø­Ø±Ù ÙÙŠ Ø§Ù„ÙƒÙ„Ù…Ø©
        print("ğŸ“ Character analysis:");
        let chars = word.chars();
        let i = 0;
        while i < chars.length() {
            let ch = chars[i];
            let semantics = get_character_semantics(ch, "en");
            print("   " + ch.to_string() + ": " + semantics);
            i = i + 1;
        }
        
        return true;
    } else {
        print("âŒ Semantic analysis failed");
        return false;
    }
}

/// Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠØ© Ù„ÙƒÙ„Ù…ØªÙŠÙ†
fn compare_semantic_signatures(word1: string, word2: string, language: string = "ar") -> f64 {
    print("ğŸ”„ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠØ©:");
    print("   Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: " + word1);
    print("   Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: " + word2);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…ØªÙŠÙ†
    let success1 = analyze_word_semantics(word1, language);
    let success2 = analyze_word_semantics(word2, language);
    
    if success1 && success2 {
        print("âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…ØªÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­");
        
        // Ù…Ù†Ø·Ù‚ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø³ÙŠØ· (Ø³ÙŠØªÙ… ØªØ·ÙˆÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§)
        let similarity = 0.75; // Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        
        print("ğŸ“Š Ø¯Ø±Ø¬Ø© Ø§Ù„ØªØ´Ø§Ø¨Ù‡ Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠ: " + similarity.to_string());
        return similarity;
    } else {
        print("âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„ÙƒÙ„Ù…ØªÙŠÙ† Ø£Ùˆ ÙƒÙ„Ø§Ù‡Ù…Ø§");
        return 0.0;
    }
}

/// Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø°Ø§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø©
fn discover_similar_words(target_word: string, word_list: list<string>, language: string = "ar") -> list<string> {
    print("ğŸ” Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø°Ø§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø© Ù„Ù€ '" + target_word + "':");
    
    let similar_words = list<string>();
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©
    let target_success = analyze_word_semantics(target_word, language);
    
    if target_success {
        let i = 0;
        while i < word_list.length() {
            let current_word = word_list[i];
            let similarity = compare_semantic_signatures(target_word, current_word, language);
            
            if similarity > 0.6 { // Ø¹ØªØ¨Ø© Ø§Ù„ØªØ´Ø§Ø¨Ù‡
                similar_words.push(current_word);
                print("   âœ… " + current_word + " (ØªØ´Ø§Ø¨Ù‡: " + similarity.to_string() + ")");
            }
            
            i = i + 1;
        }
        
        print("ğŸ“Š ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ " + similar_words.length().to_string() + " ÙƒÙ„Ù…Ø© Ù…ØªØ´Ø§Ø¨Ù‡Ø©");
    } else {
        print("âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©");
    }
    
    return similar_words;
}

/// ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠØ© Ù„Ù†Øµ ÙƒØ§Ù…Ù„
fn analyze_text_semantic_energy(text: string, language: string = "ar") -> string {
    print("âš¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠØ© Ù„Ù„Ù†Øµ:");
    print("ğŸ“ Ø§Ù„Ù†Øµ: " + text);
    
    let words = text.split(" ");
    let positive_energy = 0;
    let negative_energy = 0;
    let neutral_energy = 0;
    
    let i = 0;
    while i < words.length() {
        let word = words[i];
        let success = analyze_word_semantics(word, language);
        
        if success {
            // Ù…Ù†Ø·Ù‚ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ø§Ù‚Ø© (Ø³ÙŠØªÙ… ØªØ·ÙˆÙŠØ±Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ)
            // Ù‡Ø°Ø§ Ù…Ø«Ø§Ù„ Ø¨Ø³ÙŠØ·
            if word.contains("Ø­Ø¨") || word.contains("Ø³Ø¹Ø§Ø¯Ø©") || word.contains("Ù†ÙˆØ±") {
                positive_energy = positive_energy + 1;
            } else if word.contains("Ø­Ø²Ù†") || word.contains("Ø£Ù„Ù…") || word.contains("Ø¸Ù„Ø§Ù…") {
                negative_energy = negative_energy + 1;
            } else {
                neutral_energy = neutral_energy + 1;
            }
        }
        
        i = i + 1;
    }
    
    let total_words = words.length();
    let dominant_energy = "";
    
    if positive_energy > negative_energy && positive_energy > neutral_energy {
        dominant_energy = "Ø·Ø§Ù‚Ø© Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ù…Ù‡ÙŠÙ…Ù†Ø©";
    } else if negative_energy > positive_energy && negative_energy > neutral_energy {
        dominant_energy = "Ø·Ø§Ù‚Ø© Ø³Ù„Ø¨ÙŠØ© Ù…Ù‡ÙŠÙ…Ù†Ø©";
    } else {
        dominant_energy = "Ø·Ø§Ù‚Ø© Ù…ØªÙˆØ§Ø²Ù†Ø©";
    }
    
    print("ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ø§Ù‚Ø©:");
    print("   Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©: " + positive_energy.to_string() + "/" + total_words.to_string());
    print("   Ø³Ù„Ø¨ÙŠØ©: " + negative_energy.to_string() + "/" + total_words.to_string());
    print("   Ù…Ø­Ø§ÙŠØ¯Ø©: " + neutral_energy.to_string() + "/" + total_words.to_string());
    print("ğŸ¯ Ø§Ù„Ù†ØªÙŠØ¬Ø©: " + dominant_energy);
    
    return dominant_energy;
}

/// Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ØºÙˆÙŠ
fn show_linguistic_system_stats() {
    print("ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù†Ø¸Ø§Ù… Ø¯Ù„Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±ÙˆÙ:");
    let total_analyses = get_linguistic_stats();
    print("   Ø¹Ø¯Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø©: " + total_analyses.to_string());
    
    if total_analyses > 0 {
        print("âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø©!");
    } else {
        print("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø£ÙŠ ØªØ­Ù„ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯");
    }
}

/// Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ù†Ø¸Ø§Ù… Ø¯Ù„Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±ÙˆÙ
fn test_linguistic_system() -> bool {
    print("ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ù†Ø¸Ø§Ù… Ø¯Ù„Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±ÙˆÙ");
    print("=" * 50);
    print("");
    
    // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
    print("ğŸ”¤ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:");
    let arabic_success1 = analyze_arabic_word_comprehensive("Ø§Ù„Ù„Ù‡");
    print("");
    
    let arabic_success2 = analyze_arabic_word_comprehensive("Ø±Ø­Ù…Ø©");
    print("");
    
    let arabic_success3 = analyze_arabic_word_comprehensive("Ø´Ø¬Ø±Ø©");
    print("");
    
    // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
    print("ğŸ”¤ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©:");
    let english_success1 = analyze_english_word_comprehensive("tree");
    print("");
    
    let english_success2 = analyze_english_word_comprehensive("river");
    print("");
    
    // Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª
    print("ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª:");
    let similarity = compare_semantic_signatures("Ø±Ø­Ù…Ø©", "Ø­Ù†Ø§Ù†", "ar");
    print("");
    
    // Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ø§Ù‚Ø©
    print("âš¡ Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ø§Ù‚Ø©:");
    let energy = analyze_text_semantic_energy("Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ø±Ø¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠÙ†", "ar");
    print("");
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    show_linguistic_system_stats();
    print("");
    
    let all_success = arabic_success1 && arabic_success2 && arabic_success3 && 
                     english_success1 && english_success2;
    
    if all_success {
        print("ğŸŠ Ø¬Ù…ÙŠØ¹ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¸Ø§Ù… Ø¯Ù„Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±ÙˆÙ Ù†Ø¬Ø­Øª!");
        print("âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø§Ø´ØªÙ‚Ø§Ù‚ÙŠØ©!");
    } else {
        print("âŒ Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙØ´Ù„Øª");
    }
    
    return all_success;
}

// === Ø¯ÙˆØ§Ù„ FFI Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© ===

extern "C" {
    fn albayan_rt_analyze_word_semantics(word: *const i8, language: *const i8) -> i32;
    fn albayan_rt_get_character_semantics(character: i8, language: *const i8) -> *const i8;
    fn albayan_rt_get_linguistic_stats() -> i32;
    fn albayan_rt_free_linguistic_string(s: *mut i8);
}
