// tests/programs/shape_inference_engine_test.ab
// ุงุฎุชุจุงุฑ ูุญุฑู ุงุณุชูุชุงุฌ ุงูุฃุดูุงู - ุฃูู ูุญุฑู ูู ููุช ุงูุชุดุบูู
// Expert recommendation: "ุจูุงุก ุฃูู ูุญุฑู ูู ููุช ุงูุชุดุบูู - ShapeInferenceEngine"

/// ุงุฎุชุจุงุฑ ุดุงูู ููุญุฑู ุงุณุชูุชุงุฌ ุงูุฃุดูุงู
fn main() {
    println!("๐ ุจุฏุก ุงุฎุชุจุงุฑ ูุญุฑู ุงุณุชูุชุงุฌ ุงูุฃุดูุงู - ุฃูู ูุญุฑู ูู ููุช ุงูุชุดุบูู!");
    
    // 1. ุชููุฆุฉ ุงููุญุฑู
    test_engine_initialization();
    
    // 2. ุงุฎุชุจุงุฑ ุชุญููู ุงููุนุงุฏูุงุช ุฅูู ุฃุดูุงู
    test_equation_to_shape_conversion();
    
    // 3. ุงุฎุชุจุงุฑ ุชุญููู ุงูุฃุดูุงู ุฅูู ูุนุงุฏูุงุช
    test_shape_to_equation_conversion();
    
    // 4. ุงุฎุชุจุงุฑ ุงูุญุตูู ุนูู ูุนูููุงุช ุงูุฃุดูุงู
    test_shape_info_retrieval();
    
    // 5. ุงุฎุชุจุงุฑ ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ
    test_memory_management();
    
    // 6. ุงุฎุชุจุงุฑ ุฅุญุตุงุฆูุงุช ุงููุญุฑู
    test_engine_statistics();
    
    // 7. ุงุฎุชุจุงุฑ ุงูุญุงูุงุช ุงูุญุฏูุฉ
    test_edge_cases();
    
    println!("โ ุงูุชูู ุงุฎุชุจุงุฑ ูุญุฑู ุงุณุชูุชุงุฌ ุงูุฃุดูุงู ุจูุฌุงุญ!");
}

/// ุงุฎุชุจุงุฑ ุชููุฆุฉ ุงููุญุฑู
fn test_engine_initialization() {
    println!("\n๐ง ุงุฎุชุจุงุฑ ุชููุฆุฉ ุงููุญุฑู...");
    
    // ุชููุฆุฉ ุงููุญุฑู
    let init_result = math_ai::init_engine();
    
    if init_result == 0 {
        println!("โ ุชู ุชููุฆุฉ ุงููุญุฑู ุจูุฌุงุญ");
    } else {
        println!("โ ูุดู ูู ุชููุฆุฉ ุงููุญุฑู: {}", init_result);
    }
    
    // ุงูุชุญูู ูู ุญุงูุฉ ุงููุญุฑู
    let stats = math_ai::get_engine_stats();
    println!("๐ ุฅุญุตุงุฆูุงุช ุงููุญุฑู ุงูุฃูููุฉ: {}", stats);
}

/// ุงุฎุชุจุงุฑ ุชุญููู ุงููุนุงุฏูุงุช ุฅูู ุฃุดูุงู
fn test_equation_to_shape_conversion() {
    println!("\n๐ ุงุฎุชุจุงุฑ ุชุญููู ุงููุนุงุฏูุงุช ุฅูู ุฃุดูุงู...");
    
    // ูุนุงุฏูุงุช ูุฎุชููุฉ ููุงุฎุชุจุงุฑ
    let test_equations = [
        "xยฒ + yยฒ = 16",     // ุฏุงุฆุฑุฉ ูุตู ูุทุฑูุง 4
        "xยฒ + yยฒ = 25",     // ุฏุงุฆุฑุฉ ูุตู ูุทุฑูุง 5
        "y = xยฒ",           // ูุทุน ููุงูุฆ ุจุณูุท
        "y = 2x + 3",       // ุฎุท ูุณุชููู
        "xยฒ/4 + yยฒ/9 = 1",  // ูุทุน ูุงูุต
        "y = sin(x)",       // ุฏุงูุฉ ุฌูุจูุฉ
        "xยฒ + yยฒ = 1",      // ุฏุงุฆุฑุฉ ูุญุฏุฉ
    ];
    
    for equation in test_equations {
        println!("๐ ุชุญููู ุงููุนุงุฏูุฉ: {}", equation);
        
        let shape_handle = math_ai::equation_to_shape(equation);
        
        if shape_handle != 0 {
            println!("โ ุชู ุฅูุดุงุก ุงูุดูู ุจูุฌุงุญ - ุงูููุจุถ: {}", shape_handle);
            
            // ุงูุญุตูู ุนูู ูุนูููุงุช ุงูุดูู
            let shape_info = math_ai::get_shape_info(shape_handle);
            println!("๐ ูุนูููุงุช ุงูุดูู: {}", shape_info);
            
            // ุงุฎุชุจุงุฑ ุงูุชุญููู ุงูุนูุณู
            let recovered_equation = math_ai::shape_to_equation(shape_handle);
            println!("๐ ุงููุนุงุฏูุฉ ุงููุณุชูุชุฌุฉ: {}", recovered_equation);
            
            // ุชูุธูู ุงูุฐุงูุฑุฉ
            let remove_result = math_ai::remove_shape(shape_handle);
            if remove_result == 0 {
                println!("๐๏ธ  ุชู ุญุฐู ุงูุดูู ุจูุฌุงุญ");
            } else {
                println!("โ๏ธ  ุชุญุฐูุฑ: ูุดู ูู ุญุฐู ุงูุดูู");
            }
        } else {
            println!("โ ูุดู ูู ุชุญููู ุงููุนุงุฏูุฉ: {}", equation);
        }
        
        println!(""); // ุณุทุฑ ูุงุฑุบ ูููุถูุญ
    }
}

/// ุงุฎุชุจุงุฑ ุชุญููู ุงูุฃุดูุงู ุฅูู ูุนุงุฏูุงุช
fn test_shape_to_equation_conversion() {
    println!("\n๐ ุงุฎุชุจุงุฑ ุชุญููู ุงูุฃุดูุงู ุฅูู ูุนุงุฏูุงุช...");
    
    // ุฅูุดุงุก ุฃุดูุงู ูุฎุชููุฉ
    let test_shapes = [
        ("xยฒ + yยฒ = 9", "ุฏุงุฆุฑุฉ ูุตู ูุทุฑูุง 3"),
        ("y = xยฒ", "ูุทุน ููุงูุฆ ุฃุณุงุณู"),
        ("y = x", "ุฎุท ูุณุชููู ุจููู 1"),
    ];
    
    for (equation, description) in test_shapes {
        println!("๐ ุงุฎุชุจุงุฑ {}: {}", description, equation);
        
        // ุฅูุดุงุก ุงูุดูู ูู ุงููุนุงุฏูุฉ
        let shape_handle = math_ai::equation_to_shape(equation);
        
        if shape_handle != 0 {
            // ุชุญููู ุงูุดูู ุฅูู ูุนุงุฏูุฉ
            let recovered_equation = math_ai::shape_to_equation(shape_handle);
            
            println!("๐ฅ ุงููุนุงุฏูุฉ ุงูุฃุตููุฉ: {}", equation);
            println!("๐ค ุงููุนุงุฏูุฉ ุงููุณุชูุชุฌุฉ: {}", recovered_equation);
            
            // ููุงุฑูุฉ ุงููุชุงุฆุฌ (ุชุญููู ุจุณูุท)
            if recovered_equation.contains("x") && recovered_equation.contains("y") {
                println!("โ ุงูุชุญููู ุงูุนูุณู ูุฌุญ - ุชุญุชูู ุนูู ุงููุชุบูุฑุงุช ุงููุชููุนุฉ");
            } else {
                println!("โ๏ธ  ุงูุชุญููู ุงูุนูุณู ูุฏ ูุญุชุงุฌ ุชุญุณูู");
            }
            
            // ุชูุธูู
            math_ai::remove_shape(shape_handle);
        } else {
            println!("โ ูุดู ูู ุฅูุดุงุก ุงูุดูู ูู ุงููุนุงุฏูุฉ");
        }
        
        println!("");
    }
}

/// ุงุฎุชุจุงุฑ ุงูุญุตูู ุนูู ูุนูููุงุช ุงูุฃุดูุงู
fn test_shape_info_retrieval() {
    println!("\n๐ ุงุฎุชุจุงุฑ ุงูุญุตูู ุนูู ูุนูููุงุช ุงูุฃุดูุงู...");
    
    // ุฅูุดุงุก ุฏุงุฆุฑุฉ ููุงุฎุชุจุงุฑ
    let circle_equation = "xยฒ + yยฒ = 16";
    let circle_handle = math_ai::equation_to_shape(circle_equation);
    
    if circle_handle != 0 {
        println!("๐ ุชุญููู ุฏุงุฆุฑุฉ: {}", circle_equation);
        
        let shape_info = math_ai::get_shape_info(circle_handle);
        println!("๐ ูุนูููุงุช ุงูุดูู ุงููุงููุฉ: {}", shape_info);
        
        // ุชุญููู ุงููุนูููุงุช (JSON parsing ุจุณูุท)
        if shape_info.contains("Circle") {
            println!("โ ุชู ุงูุชุนุฑู ุนูู ุงูุดูู ูุฏุงุฆุฑุฉ");
        }
        
        if shape_info.contains("area") {
            println!("โ ุชู ุญุณุงุจ ุงููุณุงุญุฉ");
        }
        
        if shape_info.contains("perimeter") {
            println!("โ ุชู ุญุณุงุจ ุงููุญูุท");
        }
        
        // ุชูุธูู
        math_ai::remove_shape(circle_handle);
    } else {
        println!("โ ูุดู ูู ุฅูุดุงุก ุงูุฏุงุฆุฑุฉ ููุงุฎุชุจุงุฑ");
    }
}

/// ุงุฎุชุจุงุฑ ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ
fn test_memory_management() {
    println!("\n๐๏ธ  ุงุฎุชุจุงุฑ ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ...");
    
    let mut shape_handles = [];
    
    // ุฅูุดุงุก ุนุฏุฉ ุฃุดูุงู
    println!("๐ฆ ุฅูุดุงุก ุนุฏุฉ ุฃุดูุงู...");
    for i in 1..6 {
        let equation = format!("xยฒ + yยฒ = {}", i * i);
        let handle = math_ai::equation_to_shape(&equation);
        
        if handle != 0 {
            shape_handles.push(handle);
            println!("โ ุชู ุฅูุดุงุก ุงูุดูู {} - ุงูููุจุถ: {}", i, handle);
        }
    }
    
    // ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงููุญุฑู
    let stats_before = math_ai::get_engine_stats();
    println!("๐ ุฅุญุตุงุฆูุงุช ูุจู ุงูุชูุธูู: {}", stats_before);
    
    // ุญุฐู ุฌููุน ุงูุฃุดูุงู
    println!("๐๏ธ  ุญุฐู ุฌููุน ุงูุฃุดูุงู...");
    for handle in shape_handles {
        let remove_result = math_ai::remove_shape(handle);
        if remove_result == 0 {
            println!("โ ุชู ุญุฐู ุงูุดูู {} ุจูุฌุงุญ", handle);
        } else {
            println!("โ ูุดู ูู ุญุฐู ุงูุดูู {}", handle);
        }
    }
    
    // ุนุฑุถ ุฅุญุตุงุฆูุงุช ุจุนุฏ ุงูุชูุธูู
    let stats_after = math_ai::get_engine_stats();
    println!("๐ ุฅุญุตุงุฆูุงุช ุจุนุฏ ุงูุชูุธูู: {}", stats_after);
}

/// ุงุฎุชุจุงุฑ ุฅุญุตุงุฆูุงุช ุงููุญุฑู
fn test_engine_statistics() {
    println!("\n๐ ุงุฎุชุจุงุฑ ุฅุญุตุงุฆูุงุช ุงููุญุฑู...");
    
    // ุงูุญุตูู ุนูู ุงูุฅุญุตุงุฆูุงุช ุงูุญุงููุฉ
    let initial_stats = math_ai::get_engine_stats();
    println!("๐ ุงูุฅุญุตุงุฆูุงุช ุงูุฃูููุฉ: {}", initial_stats);
    
    // ุฅูุดุงุก ุจุนุถ ุงูุฃุดูุงู
    let shapes = [
        math_ai::equation_to_shape("xยฒ + yยฒ = 4"),
        math_ai::equation_to_shape("y = xยฒ"),
        math_ai::equation_to_shape("y = 2x + 1"),
    ];
    
    // ุงูุญุตูู ุนูู ุงูุฅุญุตุงุฆูุงุช ุจุนุฏ ุงูุฅูุดุงุก
    let after_creation_stats = math_ai::get_engine_stats();
    println!("๐ ุงูุฅุญุตุงุฆูุงุช ุจุนุฏ ุงูุฅูุดุงุก: {}", after_creation_stats);
    
    // ุชูุธูู ุงูุฃุดูุงู
    for shape in shapes {
        if shape != 0 {
            math_ai::remove_shape(shape);
        }
    }
    
    // ุงูุฅุญุตุงุฆูุงุช ุงูููุงุฆูุฉ
    let final_stats = math_ai::get_engine_stats();
    println!("๐ ุงูุฅุญุตุงุฆูุงุช ุงูููุงุฆูุฉ: {}", final_stats);
}

/// ุงุฎุชุจุงุฑ ุงูุญุงูุงุช ุงูุญุฏูุฉ
fn test_edge_cases() {
    println!("\nโ๏ธ  ุงุฎุชุจุงุฑ ุงูุญุงูุงุช ุงูุญุฏูุฉ...");
    
    // ุงุฎุชุจุงุฑ ูุนุงุฏูุฉ ูุงุฑุบุฉ
    println!("๐ ุงุฎุชุจุงุฑ ูุนุงุฏูุฉ ูุงุฑุบุฉ...");
    let empty_handle = math_ai::equation_to_shape("");
    if empty_handle == 0 {
        println!("โ ุชู ุงูุชุนุงูู ูุน ุงููุนุงุฏูุฉ ุงููุงุฑุบุฉ ุจุดูู ุตุญูุญ");
    } else {
        println!("โ๏ธ  ุชุญุฐูุฑ: ุงููุนุงุฏูุฉ ุงููุงุฑุบุฉ ุฃูุชุฌุช ููุจุถ ุตุงูุญ");
        math_ai::remove_shape(empty_handle);
    }
    
    // ุงุฎุชุจุงุฑ ูุนุงุฏูุฉ ุบูุฑ ุตุงูุญุฉ
    println!("๐ ุงุฎุชุจุงุฑ ูุนุงุฏูุฉ ุบูุฑ ุตุงูุญุฉ...");
    let invalid_handle = math_ai::equation_to_shape("abc123xyz");
    if invalid_handle == 0 {
        println!("โ ุชู ุงูุชุนุงูู ูุน ุงููุนุงุฏูุฉ ุบูุฑ ุงูุตุงูุญุฉ ุจุดูู ุตุญูุญ");
    } else {
        println!("โ๏ธ  ุชุญุฐูุฑ: ุงููุนุงุฏูุฉ ุบูุฑ ุงูุตุงูุญุฉ ุฃูุชุฌุช ููุจุถ ุตุงูุญ");
        math_ai::remove_shape(invalid_handle);
    }
    
    // ุงุฎุชุจุงุฑ ููุจุถ ุบูุฑ ุตุงูุญ
    println!("๐ ุงุฎุชุจุงุฑ ููุจุถ ุบูุฑ ุตุงูุญ...");
    let invalid_equation = math_ai::shape_to_equation(999999);
    if invalid_equation == "" {
        println!("โ ุชู ุงูุชุนุงูู ูุน ุงูููุจุถ ุบูุฑ ุงูุตุงูุญ ุจุดูู ุตุญูุญ");
    } else {
        println!("โ๏ธ  ุชุญุฐูุฑ: ุงูููุจุถ ุบูุฑ ุงูุตุงูุญ ุฃูุชุฌ ูุนุงุฏูุฉ: {}", invalid_equation);
    }
    
    // ุงุฎุชุจุงุฑ ุญุฐู ููุจุถ ุบูุฑ ููุฌูุฏ
    println!("๐ ุงุฎุชุจุงุฑ ุญุฐู ููุจุถ ุบูุฑ ููุฌูุฏ...");
    let remove_result = math_ai::remove_shape(888888);
    if remove_result != 0 {
        println!("โ ุชู ุงูุชุนุงูู ูุน ุงูููุจุถ ุบูุฑ ุงูููุฌูุฏ ุจุดูู ุตุญูุญ");
    } else {
        println!("โ๏ธ  ุชุญุฐูุฑ: ุญุฐู ููุจุถ ุบูุฑ ููุฌูุฏ ูุฌุญ ุจุดูู ุบูุฑ ูุชููุน");
    }
}

/// ุฏุงูุฉ ูุณุงุนุฏุฉ ูุทุจุงุนุฉ ุงููุชุงุฆุฌ
fn print_test_result(test_name: &str, success: bool) {
    if success {
        println!("โ {}: ูุฌุญ", test_name);
    } else {
        println!("โ {}: ูุดู", test_name);
    }
}
